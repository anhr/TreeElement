<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Tree Element</title>
    <meta name="author" content="Andrej Hristoliubov anhr@mail.ru">
    <style>
        .branchLeft {
            margin-left: 10px;
        }

        /* thanks to http://jsfiddle.net/FtL6G/ */
        .b-toggle {
            opacity: 0;
            max-height: 0;
            overflow: auto;/*hidden;*/
            -moz-transition: opacity 1s, max-height 1s;
            -ms-transition: opacity 1s, max-height 1s;
            transition: opacity 1s, max-height 1s;
            _display: none;
        }
        .expanded {
            max-height: 1000px;
            opacity: 1;
            _display: block;
        }
    </style>

    <script type="text/javascript">
        var myBranch = {
            create: function (name, params, title, tagName) {
                var el = document.createElement((typeof tagName == 'undefined') ? "div" : tagName);
                el.innerHTML =
                    '<a href="#" onclick="javascript: myBranch.onclickBranch(this)" ' + (((typeof title == 'undefined') || title == '') ? '' : 'title="' + title + '"') + '>'
                        + '<b>'
                            + '<span class="triangle">▶</span>'
                            + '<span class="name">' + name + '</span>'
                        + '</b>'
                    + '</a>'
                ;
                var elA = el.querySelector('a');
                elA.params = params;
                return el;
            },
            onclickBranch: function (a) {
                consoleLog("onclickBranch()");
                var elBranch = a.parentElement.querySelector('.branch')
                var triangle;
                var isOpened = elBranch ?
                    (
                        (elBranch.className.indexOf('b-toggle') == -1) ?
                        true :
                        ((elBranch.className.indexOf(' expanded') != -1) ? true : false)
                    )
                    : false;
                if (isOpened) {
                    if (a.branchElement.className.indexOf('b-toggle') != -1)
                        a.branchElement.className = a.branchElement.className.replace(' expanded', '');
                    else a.parentElement.removeChild(elBranch);
                    triangle = '▶';
                    isOpened = false;
                    if (typeof a.params.onCloseBranch != 'undefined')
                        a.params.onCloseBranch(a);
                } else {
                    if (typeof a.branchElement == 'undefined')
                        a.branchElement = a.params.createBranch();
                    if (!elBranch) {
                        if (a.branchElement.className.indexOf(' branch') == -1)
                            a.branchElement.className += ' branch';
                        a.parentElement.appendChild(a.branchElement);
                    }

                    if (a.branchElement.className.indexOf('b-toggle') != -1)
                        a.branchElement.className += ' expanded';

                    triangle = '▼';
                    isOpened = true;
                    if (typeof a.params.onOpenBranch != 'undefined')
                        a.params.onOpenBranch(a);
                }
                a.querySelector('.triangle').innerHTML = triangle;
                return isOpened;
            }
        }
        function consoleLog(message) { console.log(message); }
        function consoleError(message) {
            alert(message);
            //console.error(message);
        }
    </script>
</head>
<body>
    <p><a href='../index.html'>Home</a> | <a href='https://github.com/anhr/TreeElement' target="_blank">GitHub</a></p>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- Рекламный блок -->
    <ins class="adsbygoogle"
         style="display:inline-block;width:728px;height:90px"
         data-ad-client="ca-pub-2575715742658777"
         data-ad-slot="8810450588"></ins>
    <script>
	(adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <h1>Tree Elements</h1>

    <!--Simple Tree-->
    <h2 >Simple Tree</h2>
    <div id="SimpleTree"></div>
    <script type="text/javascript">
        try{
            document.getElementById("SimpleTree").appendChild(myBranch.create("Simple Tree",
                //params
                {
                    createBranch: function () {
                        var el = document.createElement("div");
                        el.className = "branchLeft";
                        el.innerText = "Branch";
                        return el;
                    }
                }));
        } catch (e) {
            consoleError(e.message);
        }
    </script>

    <!--Simple Tree 2-->
    <h2>Simple Tree 2</h2>
    <div id="SimpleTree2"></div>
    <script type="text/javascript">
        try {
            document.getElementById("SimpleTree2").appendChild(myBranch.create("Open Branch",
                //params
                {
                    createBranch: function () {
                        var el = document.createElement("div");
                        el.className = "branchLeft";
                        el.innerText = "Branch";
                        return el;
                    },
                    onOpenBranch: function (a) { a.querySelector(".name").innerText = "Close Branch"; },
                    onCloseBranch: function (a) { a.querySelector(".name").innerText = "Open Branch"; }
                }));
        } catch (e) {
            consoleError(e.message);
        }
    </script>

    <!--Complex Tree-->
    <h2>Complex Tree</h2>
    <div id="ComplexTree"></div>
    <script type="text/javascript">
        try {
            var tree = [
                {
                    name: "Opacity Branch",
                    branch: "branch 1",
                    className: "b-toggle",
                    tree: [
                        {
                            name: "tree 2.1",
                            tree: [
                                {
                                    name: "tree 2.2",
                                    branch: "branch 2.2"
                                }
                            ]
                        }
                    ]
                },
                {
                    name: "Complex Tree 2",
                    branch: function () {
                        var el = document.createElement("div");
                        el.className = "branchLeft";
                        el.appendChild(document.createElement("input"));
                        return el;
                    },
                    title: "inline-element",
                    tagName: "span"
                },
                {
                    name: "Complex Tree 3",
                    branch: "branch 3",
                    title: "inline-element",
                    tagName: "span"
                }
            ];
            function appendBranch(elTree, branch) {
                elTree.appendChild(myBranch.create(branch.name,
                    //params
                    {
                        createBranch: function () {
                            if (typeof branch.branch == "function")
                                return branch.branch();
                            else {
                                var el = document.createElement("div");
                                el.className = "branchLeft" + (branch.className ? " " + branch.className : "");
                                var res = false;
                                if (typeof branch.branch == "string") {
                                    el.innerText = branch.branch;
                                    res = true;
                                }
                                if (this.tree) {
                                    this.tree.forEach(function (branch) {
                                        appendBranch(el, branch);
                                    });
                                    res = true;
                                }
                                if (!res)
                                    consoleError("Invalid branch");
                                return el;
                            } 
                        },
                        tree: branch.tree
                    },
                    branch.title,
                    branch.tagName
                ));
            }
            var elComplexTree = document.getElementById("ComplexTree");
            tree.forEach(function (branch) {
                appendBranch(elComplexTree, branch)
            });
        } catch (e) {
            consoleError(e.message);
        }
    </script>
</body>
</html>